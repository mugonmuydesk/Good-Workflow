<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeMap - Visual Call Graph</title>
    
    <!-- Cytoscape.js for graph visualization -->
    <script src="https://cdn.jsdelivr.net/npm/cytoscape@3.27.0/dist/cytoscape.min.js"></script>
    
    <!-- Cytoscape layouts -->
    <script src="https://cdn.jsdelivr.net/npm/cytoscape-dagre@2.5.0/cytoscape-dagre.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dagre@0.8.5/dist/dagre.min.js"></script>
    
    <!-- Application styles -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header with controls -->
    <header id="controls">
        <div class="logo">
            <h1>CodeMap</h1>
            <span class="subtitle">Visual Call Graph</span>
        </div>
        
        <div class="toolbar">
            <!-- Layout controls -->
            <div class="control-group">
                <label for="layout-select">Layout:</label>
                <select id="layout-select">
                    <option value="dagre">Hierarchical</option>
                    <option value="breadthfirst">Breadth First</option>
                    <option value="circle">Circle</option>
                    <option value="concentric">Concentric</option>
                    <option value="grid">Grid</option>
                </select>
            </div>
            
            <!-- Filter controls -->
            <div class="control-group">
                <label for="filter-input">Filter:</label>
                <input type="text" id="filter-input" placeholder="Filter functions...">
            </div>
            
            <!-- View controls -->
            <div class="control-group">
                <button id="fit-button" title="Fit to viewport">Fit</button>
                <button id="reset-button" title="Reset view">Reset</button>
            </div>
            
            <!-- Export controls -->
            <div class="control-group">
                <button id="export-png" title="Export as PNG">Export PNG</button>
                <button id="export-json" title="Export as JSON">Export JSON</button>
            </div>
            
            <!-- Settings toggle -->
            <div class="control-group">
                <button id="settings-button" title="Settings">âš™ Settings</button>
            </div>
        </div>
        
        <div class="stats">
            <span id="node-count">0 functions</span>
            <span id="edge-count">0 calls</span>
        </div>
    </header>
    
    <!-- Main graph container -->
    <main id="graph-container">
        <div id="cytoscape"></div>
        
        <!-- Loading indicator -->
        <div id="loading" class="hidden">
            <div class="spinner"></div>
            <p>Loading graph...</p>
        </div>
        
        <!-- Error message -->
        <div id="error" class="hidden">
            <p id="error-message"></p>
        </div>
    </main>
    
    <!-- Sidebar for node details -->
    <aside id="sidebar" class="hidden">
        <div class="sidebar-header">
            <h2>Function Details</h2>
            <button id="close-sidebar">&times;</button>
        </div>
        
        <div id="node-details">
            <div class="detail-row">
                <span class="detail-label">Name:</span>
                <span id="detail-name" class="detail-value"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">File:</span>
                <span id="detail-file" class="detail-value"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Line:</span>
                <span id="detail-line" class="detail-value"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Status:</span>
                <span id="detail-status" class="detail-value"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Calls:</span>
                <ul id="detail-calls" class="detail-list"></ul>
            </div>
            <div class="detail-row">
                <span class="detail-label">Called by:</span>
                <ul id="detail-callers" class="detail-list"></ul>
            </div>
        </div>
    </aside>
    
    <!-- Legend -->
    <div id="legend">
        <h3>Legend</h3>
        <div class="legend-item">
            <span class="legend-color implemented"></span>
            <span>Implemented</span>
        </div>
        <div class="legend-item">
            <span class="legend-color stub"></span>
            <span>Stub/TODO</span>
        </div>
        <div class="legend-item">
            <span class="legend-color missing"></span>
            <span>Missing</span>
        </div>
        <div class="legend-item">
            <span class="legend-color external"></span>
            <span>External</span>
        </div>
    </div>
    
    <!-- Settings Panel -->
    <div id="settings-panel" class="hidden">
        <div class="settings-header">
            <h2>Settings</h2>
            <button id="close-settings">&times;</button>
        </div>
        
        <div class="settings-content">
            <div class="settings-section">
                <h3>Display Options</h3>
                
                <div class="setting-item">
                    <label for="show-edge-labels">
                        <input type="checkbox" id="show-edge-labels" checked>
                        Show edge labels (line numbers)
                    </label>
                </div>
                
                <div class="setting-item">
                    <label for="show-tooltips">
                        <input type="checkbox" id="show-tooltips" checked>
                        Show enhanced tooltips on hover
                    </label>
                </div>
                
                <div class="setting-item">
                    <label for="auto-group-modules">
                        <input type="checkbox" id="auto-group-modules" checked>
                        Auto-group functions by module
                    </label>
                </div>
            </div>
            
            <div class="settings-section">
                <h3>Appearance</h3>
                
                <div class="setting-item">
                    <label for="node-size">
                        Node size:
                        <input type="range" id="node-size" min="50" max="200" value="100">
                        <span id="node-size-value">100%</span>
                    </label>
                </div>
                
                <div class="setting-item">
                    <label for="edge-width">
                        Edge width:
                        <input type="range" id="edge-width" min="1" max="5" value="2">
                        <span id="edge-width-value">2px</span>
                    </label>
                </div>
                
                <div class="setting-item">
                    <label for="font-size">
                        Font size:
                        <input type="range" id="font-size" min="8" max="16" value="12">
                        <span id="font-size-value">12px</span>
                    </label>
                </div>
            </div>
            
            <div class="settings-section">
                <h3>Performance</h3>
                
                <div class="setting-item">
                    <label for="animation-enabled">
                        <input type="checkbox" id="animation-enabled" checked>
                        Enable layout animations
                    </label>
                </div>
                
                <div class="setting-item">
                    <label for="high-quality-render">
                        <input type="checkbox" id="high-quality-render" checked>
                        High quality rendering
                    </label>
                </div>
            </div>
            
            <div class="settings-section">
                <button id="reset-settings" class="settings-button">Reset to Defaults</button>
                <button id="apply-settings" class="settings-button primary">Apply Changes</button>
            </div>
        </div>
    </div>
    
    <!-- Application JavaScript -->
    <script src="app.js"></script>
</body>
</html>